# 데이터 파싱

* 작성자: 국민대학교 기계공학부 김찬우

  

슬레이브 보드에서 다음과 같은 정보 전송

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled.png)

마스터보드와 매트랩이 다음과 같이 데이터를 받음

**[Slave1]:0.000,±0.000F**

**[Slave1]:0.000,±0.000F**

**[Slave1]:0.000,±0.000F**

**[Slave1]:0.000,±0.000F**

**[Slave1]:0.000,±0.000F**

…



아두이노의 동작클럭(16Mhz)와 보드레이트(57600bps)  사이 보드레이트오차 +2.1%

따라서 전송 중 데이터가 깨질 수가 있다.

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled%201.png)

데이터 깨짐의 예)

**[Slave1]:12.654,-0.654F**

**[Slave1]:12.662,-0.254F**

**[Slave1]:12.670,0.354Fve1]:12.678,-1.742F**

**[Sla[Slave1]:12.686,-0.23**

**[Slave1]:12.694,0.244F**

**[Slave1]:12.702,1.355F**

…

해결방법

깨진 데이터는 그대로 매트랩으로 String형으로 불러와

(매트랩에서는 한 줄 씩 (개행문자(\n)구분하여) 데이터를 불러옴)

데이터를 파싱하여 깨진 데이터를 구분하여 데이터가 깨진 것을 판단하면, 해당 줄(깨진 데이터)를 버림.

매트랩 코드의 데이터 파싱 부분

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled%202.png)

구문별 해석

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled%203.png)

아두이노의 데이터 한 줄을 스캔(string형)

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled%204.png)

불러온 데이터 한 줄에서 “[” 와 “]” 사이 “Slave1” 이라는 글자가 정확하게 있어야함.

불러온 데이터 한 줄에 “F” 문자는 단 하나 있어야함.

불러온 데이터 한 줄에 “:” 문자는 단 하나 있어야함.

불러온 데이터 한 줄에 “,” 문자는 단 하나 있어야함.

예시)

[Slave1]**:**12.662,-0.254F    → 조건 만족

[Slave1]**:**12.670,0.354Fve1]**:**12.678,-1.742F     → 조건 불만족 → 삭제

[Sla[Slave1]:12.686,-0.23      → 조건 불만족 → 삭제

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled%205.png)

위 모든 조건을 만족한다면 불러온데이터 한 줄에는 무조건 “F” 문자가 마막에 있어야함.

예시)

[Slave1]**:**12.662,-0.254F    → 조건 만족

[Slave1]**:**12.670,0.354Fve1]**:**12.678,-1.742F     → 조건 만족이지만 이전 조건에서 삭제됨

[Sla[Slave1]:12.686,-0.23      → 조건 불만족 → 이미 이전 조건에서 삭제됨

![Untitled](%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%91%E1%85%A1%E1%84%89%E1%85%B5%E1%86%BC%200d775b47d8004c3586c52d5f0458b019/Untitled%206.png)

위 모든 조건을 만족한다면 불러온데이터 한 줄에서 “:” 와 “,” 사이 있는 문자(시간정보)를 파싱하여 str_t 라는 변수에 저장(시간데이터 저장).

또한 “,” 와 “F” 사이 있는 문자(가속도정보)를 파싱하여 str_a라는 변수에 저장(가속도 데이터 저장)

이후 str_t, str_a 는 double형으로 변환(문자데이터지만, 숫자만 존재하므로, 더블형으로 변환 가능)하여 숫자데이터로 저장.

이 때 숫자데이터로 저장할 때 문자데이터가 섞여있으면, 데이터 삭제. 

예시)

[Slave1]**:**12.662,-0.254F    → 조건 만족

[Slave1]**:**12.670,0.354Fve1]**:**12.678,-1.742F     → 조건 불만족 → 이미 이전 조건에서 삭제됨

[Sla[Slave1]:12.686,-0.23      → 조건 불만족 → 이미 이전 조건에서 삭제됨

이 과정들을 통해 잘못 된 데이터들은 걸러낼 수 있다.
